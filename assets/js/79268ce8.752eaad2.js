"use strict";(self.webpackChunktapwork_docs=self.webpackChunktapwork_docs||[]).push([[6119],{2754:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"architecture/data-architecture","title":"Data Architecture","description":"This document describes the database schema, data models, and relationships within the TAPWORK system.","source":"@site/docs/architecture/data-architecture.md","sourceDirName":"architecture","slug":"/architecture/data-architecture","permalink":"/tapwork-docs/architecture/data-architecture","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Component Architecture","permalink":"/tapwork-docs/architecture/components"},"next":{"title":"API Architecture","permalink":"/tapwork-docs/architecture/api-architecture"}}');var s=i(4848),d=i(8453);const l={},t="Data Architecture",c={},a=[{value:"Database Schema Overview",id:"database-schema-overview",level:2},{value:"Design Principles",id:"design-principles",level:3},{value:"Entity Relationship Diagram",id:"entity-relationship-diagram",level:2},{value:"Table Definitions",id:"table-definitions",level:2},{value:"Users Table",id:"users-table",level:3},{value:"Attendance Records Table",id:"attendance-records-table",level:3},{value:"QR Codes Table",id:"qr-codes-table",level:3},{value:"Roles Table",id:"roles-table",level:3},{value:"Departments Table",id:"departments-table",level:3},{value:"Shifts Table",id:"shifts-table",level:3},{value:"Biometric Data Table (Optional)",id:"biometric-data-table-optional",level:3},{value:"Audit Logs Table",id:"audit-logs-table",level:3},{value:"Data Relationships",id:"data-relationships",level:2},{value:"One-to-Many Relationships",id:"one-to-many-relationships",level:3},{value:"One-to-One Relationships",id:"one-to-one-relationships",level:3},{value:"Data Access Patterns",id:"data-access-patterns",level:2},{value:"Common Queries",id:"common-queries",level:3},{value:"Data Migration Strategy",id:"data-migration-strategy",level:2},{value:"Version Control",id:"version-control",level:3},{value:"Migration Process",id:"migration-process",level:3},{value:"Backup and Recovery",id:"backup-and-recovery",level:2},{value:"Backup Strategy",id:"backup-strategy",level:3},{value:"Recovery Procedures",id:"recovery-procedures",level:3},{value:"Performance Optimization",id:"performance-optimization",level:2},{value:"Indexing Strategy",id:"indexing-strategy",level:3},{value:"Query Optimization",id:"query-optimization",level:3},{value:"Future Enhancements",id:"future-enhancements",level:3}];function o(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"data-architecture",children:"Data Architecture"})}),"\n",(0,s.jsx)(n.p,{children:"This document describes the database schema, data models, and relationships within the TAPWORK system."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"database-schema-overview",children:"Database Schema Overview"}),"\n",(0,s.jsx)(n.p,{children:"TAPWORK uses PostgreSQL as its primary database, with a normalized relational schema designed for data integrity, query performance, and scalability."}),"\n",(0,s.jsx)(n.h3,{id:"design-principles",children:"Design Principles"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Normalization"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Third Normal Form (3NF) to minimize redundancy"}),"\n",(0,s.jsx)(n.li,{children:"Clear separation of concerns across tables"}),"\n",(0,s.jsx)(n.li,{children:"Foreign key constraints enforce referential integrity"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Performance"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Strategic indexing on frequently queried columns"}),"\n",(0,s.jsx)(n.li,{children:"Composite indexes for multi-column queries"}),"\n",(0,s.jsx)(n.li,{children:"Partial indexes for filtered queries"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Scalability"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Connection pooling for efficient resource usage"}),"\n",(0,s.jsx)(n.li,{children:"Prepared statements for query optimization"}),"\n",(0,s.jsx)(n.li,{children:"Partitioning strategies for large tables (future)"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"entity-relationship-diagram",children:"Entity Relationship Diagram"}),"\n",(0,s.jsx)(n.mermaid,{value:'erDiagram\r\n    USERS ||--o{ ATTENDANCE_RECORDS : records\r\n    USERS ||--o| QR_CODES : has\r\n    USERS }o--|| ROLES : "has role"\r\n    USERS }o--|| DEPARTMENTS : "belongs to"\r\n    USERS }o--|| SHIFTS : "assigned to"\r\n    USERS ||--o| BIOMETRIC_DATA : "has (optional)"\r\n    ATTENDANCE_RECORDS }o--|| SHIFTS : "during shift"\r\n    AUDIT_LOGS }o--|| USERS : "performed by"\r\n\r\n    USERS {\r\n        uuid id PK\r\n        string email UK\r\n        string password_hash\r\n        string first_name\r\n        string last_name\r\n        string employee_id UK\r\n        uuid role_id FK\r\n        uuid department_id FK\r\n        uuid shift_id FK\r\n        boolean is_active\r\n        timestamp created_at\r\n        timestamp updated_at\r\n    }\r\n\r\n    ATTENDANCE_RECORDS {\r\n        uuid id PK\r\n        uuid user_id FK\r\n        timestamp check_in\r\n        timestamp check_out\r\n        string status\r\n        string location\r\n        string notes\r\n        uuid shift_id FK\r\n        timestamp created_at\r\n    }\r\n\r\n    QR_CODES {\r\n        uuid id PK\r\n        uuid user_id FK\r\n        string code_data UK\r\n        timestamp generated_at\r\n        timestamp expires_at\r\n        boolean is_active\r\n    }\r\n\r\n    ROLES {\r\n        uuid id PK\r\n        string name UK\r\n        string description\r\n        json permissions\r\n        timestamp created_at\r\n    }\r\n\r\n    DEPARTMENTS {\r\n        uuid id PK\r\n        string name UK\r\n        string description\r\n        uuid manager_id FK\r\n        timestamp created_at\r\n    }\r\n\r\n    SHIFTS {\r\n        uuid id PK\r\n        string name\r\n        time start_time\r\n        time end_time\r\n        int grace_period_minutes\r\n        json working_days\r\n        timestamp created_at\r\n    }\r\n\r\n    BIOMETRIC_DATA {\r\n        uuid id PK\r\n        uuid user_id FK\r\n        string biometric_type\r\n        bytea biometric_hash\r\n        timestamp enrolled_at\r\n        timestamp last_verified_at\r\n    }\r\n\r\n    AUDIT_LOGS {\r\n        uuid id PK\r\n        uuid user_id FK\r\n        string action\r\n        string resource\r\n        json changes\r\n        string ip_address\r\n        timestamp created_at\r\n    }'}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"table-definitions",children:"Table Definitions"}),"\n",(0,s.jsx)(n.h3,{id:"users-table",children:"Users Table"}),"\n",(0,s.jsx)(n.p,{children:"Stores employee information and authentication credentials."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Columns:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"id"})," (UUID, PK): Unique identifier"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"email"})," (VARCHAR, UK): Employee email address"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"password_hash"})," (VARCHAR): Bcrypt hashed password"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"first_name"})," (VARCHAR): Employee first name"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"last_name"})," (VARCHAR): Employee last name"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"employee_id"})," (VARCHAR, UK): Company employee ID"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"role_id"})," (UUID, FK): Reference to roles table"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"department_id"})," (UUID, FK): Reference to departments table"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"shift_id"})," (UUID, FK): Reference to shifts table"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"is_active"})," (BOOLEAN): Account status"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"created_at"})," (TIMESTAMP): Record creation time"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"updated_at"})," (TIMESTAMP): Last update time"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Indexes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Primary key on ",(0,s.jsx)(n.code,{children:"id"})]}),"\n",(0,s.jsxs)(n.li,{children:["Unique index on ",(0,s.jsx)(n.code,{children:"email"})]}),"\n",(0,s.jsxs)(n.li,{children:["Unique index on ",(0,s.jsx)(n.code,{children:"employee_id"})]}),"\n",(0,s.jsxs)(n.li,{children:["Index on ",(0,s.jsx)(n.code,{children:"is_active"})," for filtering"]}),"\n",(0,s.jsxs)(n.li,{children:["Composite index on ",(0,s.jsx)(n.code,{children:"department_id, is_active"})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"attendance-records-table",children:"Attendance Records Table"}),"\n",(0,s.jsx)(n.p,{children:"Stores all check-in and check-out events."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Columns:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"id"})," (UUID, PK): Unique identifier"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"user_id"})," (UUID, FK): Reference to users table"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"check_in"})," (TIMESTAMP): Check-in time"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"check_out"})," (TIMESTAMP, nullable): Check-out time"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"status"})," (VARCHAR): Status (on-time, late, early, overtime)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"location"})," (VARCHAR, nullable): Check-in location"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"notes"})," (TEXT, nullable): Additional notes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"shift_id"})," (UUID, FK): Reference to shifts table"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"created_at"})," (TIMESTAMP): Record creation time"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Indexes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Primary key on ",(0,s.jsx)(n.code,{children:"id"})]}),"\n",(0,s.jsxs)(n.li,{children:["Index on ",(0,s.jsx)(n.code,{children:"user_id"})," for user queries"]}),"\n",(0,s.jsxs)(n.li,{children:["Index on ",(0,s.jsx)(n.code,{children:"check_in"})," for date range queries"]}),"\n",(0,s.jsxs)(n.li,{children:["Composite index on ",(0,s.jsx)(n.code,{children:"user_id, check_in"})," for user history"]}),"\n",(0,s.jsxs)(n.li,{children:["Index on ",(0,s.jsx)(n.code,{children:"status"})," for reporting"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Constraints:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Foreign key to ",(0,s.jsx)(n.code,{children:"users(id)"})," with CASCADE delete"]}),"\n",(0,s.jsxs)(n.li,{children:["Foreign key to ",(0,s.jsx)(n.code,{children:"shifts(id)"})]}),"\n",(0,s.jsxs)(n.li,{children:["Check constraint: ",(0,s.jsx)(n.code,{children:"check_out >= check_in"})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"qr-codes-table",children:"QR Codes Table"}),"\n",(0,s.jsx)(n.p,{children:"Manages QR code assignments for employees."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Columns:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"id"})," (UUID, PK): Unique identifier"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"user_id"})," (UUID, FK): Reference to users table"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"code_data"})," (VARCHAR, UK): Encoded QR data"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"generated_at"})," (TIMESTAMP): Generation time"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"expires_at"})," (TIMESTAMP, nullable): Expiration time"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"is_active"})," (BOOLEAN): Active status"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Indexes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Primary key on ",(0,s.jsx)(n.code,{children:"id"})]}),"\n",(0,s.jsxs)(n.li,{children:["Unique index on ",(0,s.jsx)(n.code,{children:"code_data"})]}),"\n",(0,s.jsxs)(n.li,{children:["Index on ",(0,s.jsx)(n.code,{children:"user_id"})]}),"\n",(0,s.jsxs)(n.li,{children:["Composite index on ",(0,s.jsx)(n.code,{children:"is_active, expires_at"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Constraints:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Foreign key to ",(0,s.jsx)(n.code,{children:"users(id)"})," with CASCADE delete"]}),"\n",(0,s.jsxs)(n.li,{children:["Unique constraint on ",(0,s.jsx)(n.code,{children:"user_id"})," (one active QR per user)"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"roles-table",children:"Roles Table"}),"\n",(0,s.jsx)(n.p,{children:"Defines user roles and permissions."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Columns:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"id"})," (UUID, PK): Unique identifier"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"name"}),' (VARCHAR, UK): Role name (e.g., "Employee", "Admin")']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"description"})," (TEXT): Role description"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"permissions"})," (JSONB): JSON object containing permissions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"created_at"})," (TIMESTAMP): Record creation time"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Default Roles:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Employee"}),": Basic attendance recording"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Supervisor"}),": View team attendance"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"HR Manager"}),": Manage employees and reports"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Admin"}),": Full system access"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Permission Structure:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "attendance": ["read", "create"],\r\n  "users": ["read"],\r\n  "reports": ["read", "generate"],\r\n  "settings": []\r\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"departments-table",children:"Departments Table"}),"\n",(0,s.jsx)(n.p,{children:"Organizational structure definition."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Columns:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"id"})," (UUID, PK): Unique identifier"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"name"})," (VARCHAR, UK): Department name"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"description"})," (TEXT): Department description"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"manager_id"})," (UUID, FK, nullable): Reference to users table"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"created_at"})," (TIMESTAMP): Record creation time"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Indexes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Primary key on ",(0,s.jsx)(n.code,{children:"id"})]}),"\n",(0,s.jsxs)(n.li,{children:["Unique index on ",(0,s.jsx)(n.code,{children:"name"})]}),"\n",(0,s.jsxs)(n.li,{children:["Index on ",(0,s.jsx)(n.code,{children:"manager_id"})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"shifts-table",children:"Shifts Table"}),"\n",(0,s.jsx)(n.p,{children:"Work shift definitions and schedules."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Columns:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"id"})," (UUID, PK): Unique identifier"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"name"}),' (VARCHAR): Shift name (e.g., "Morning", "Night")']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"start_time"})," (TIME): Shift start time"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"end_time"})," (TIME): Shift end time"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"grace_period_minutes"})," (INTEGER): Late arrival grace period"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"working_days"})," (JSONB): Array of working days [1-7]"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"created_at"})," (TIMESTAMP): Record creation time"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example Working Days:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:"[1, 2, 3, 4, 5]  // Monday through Friday\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"biometric-data-table-optional",children:"Biometric Data Table (Optional)"}),"\n",(0,s.jsx)(n.p,{children:"Stores biometric enrollment data for enhanced security."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Columns:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"id"})," (UUID, PK): Unique identifier"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"user_id"})," (UUID, FK): Reference to users table"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"biometric_type"})," (VARCHAR): Type (face, fingerprint)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"biometric_hash"})," (BYTEA): Encrypted biometric template"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"enrolled_at"})," (TIMESTAMP): Enrollment time"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"last_verified_at"})," (TIMESTAMP, nullable): Last verification time"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Security:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Biometric data is hashed/encrypted, never stored raw"}),"\n",(0,s.jsx)(n.li,{children:"Compliant with GDPR, BIPA, CCPA requirements"}),"\n",(0,s.jsx)(n.li,{children:"Strict access controls on this table"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"audit-logs-table",children:"Audit Logs Table"}),"\n",(0,s.jsx)(n.p,{children:"Tracks all system actions for compliance and security."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Columns:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"id"})," (UUID, PK): Unique identifier"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"user_id"})," (UUID, FK, nullable): User who performed action"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"action"})," (VARCHAR): Action type (CREATE, UPDATE, DELETE, LOGIN)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"resource"})," (VARCHAR): Resource affected (users, attendance)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"changes"})," (JSONB): JSON object with old/new values"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ip_address"})," (VARCHAR): Client IP address"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"created_at"})," (TIMESTAMP): Action timestamp"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Indexes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Primary key on ",(0,s.jsx)(n.code,{children:"id"})]}),"\n",(0,s.jsxs)(n.li,{children:["Index on ",(0,s.jsx)(n.code,{children:"user_id"})]}),"\n",(0,s.jsxs)(n.li,{children:["Index on ",(0,s.jsx)(n.code,{children:"created_at"})," for time-based queries"]}),"\n",(0,s.jsxs)(n.li,{children:["Index on ",(0,s.jsx)(n.code,{children:"action"})," for filtering"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"data-relationships",children:"Data Relationships"}),"\n",(0,s.jsx)(n.h3,{id:"one-to-many-relationships",children:"One-to-Many Relationships"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"User \u2192 Attendance Records"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"One user can have many attendance records"}),"\n",(0,s.jsx)(n.li,{children:"Cascade delete: Deleting a user removes their attendance history"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"User \u2192 Audit Logs"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"One user can have many audit log entries"}),"\n",(0,s.jsx)(n.li,{children:"No cascade delete: Logs persist for compliance"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Department \u2192 Users"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"One department contains many users"}),"\n",(0,s.jsx)(n.li,{children:"Restrict delete: Cannot delete department with assigned users"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Shift \u2192 Users"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"One shift can be assigned to many users"}),"\n",(0,s.jsx)(n.li,{children:"Restrict delete: Cannot delete shift with assigned users"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"one-to-one-relationships",children:"One-to-One Relationships"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"User \u2194 QR Code"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Each user has exactly one active QR code"}),"\n",(0,s.jsx)(n.li,{children:"Cascade delete: Deleting user removes QR code"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"User \u2194 Biometric Data"})," (Optional)"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Each user can have one biometric enrollment per type"}),"\n",(0,s.jsx)(n.li,{children:"Cascade delete: Deleting user removes biometric data"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"data-access-patterns",children:"Data Access Patterns"}),"\n",(0,s.jsx)(n.h3,{id:"common-queries",children:"Common Queries"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Get User Attendance History"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM attendance_records \r\nWHERE user_id = ? \r\nAND check_in >= ? \r\nAND check_in < ?\r\nORDER BY check_in DESC;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Find Late Arrivals Today"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT u.*, a.*, s.start_time\r\nFROM attendance_records a\r\nJOIN users u ON a.user_id = u.id\r\nJOIN shifts s ON a.shift_id = s.id\r\nWHERE DATE(a.check_in) = CURRENT_DATE\r\nAND TIME(a.check_in) > s.start_time + INTERVAL '? minutes'\r\nAND a.status = 'late';\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Department Attendance Summary"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT d.name, COUNT(a.id) as check_ins, \r\n       COUNT(CASE WHEN a.status = 'late' THEN 1 END) as late_count\r\nFROM departments d\r\nJOIN users u ON d.id = u.department_id\r\nJOIN attendance_records a ON u.id = a.user_id\r\nWHERE DATE(a.check_in) = CURRENT_DATE\r\nGROUP BY d.name;\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"data-migration-strategy",children:"Data Migration Strategy"}),"\n",(0,s.jsx)(n.h3,{id:"version-control",children:"Version Control"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Alembic for database migrations"}),"\n",(0,s.jsx)(n.li,{children:"Sequential migration scripts"}),"\n",(0,s.jsx)(n.li,{children:"Rollback support for all migrations"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"migration-process",children:"Migration Process"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Create migration script"}),"\n",(0,s.jsx)(n.li,{children:"Test on development database"}),"\n",(0,s.jsx)(n.li,{children:"Review and approve changes"}),"\n",(0,s.jsx)(n.li,{children:"Apply to staging environment"}),"\n",(0,s.jsx)(n.li,{children:"Deploy to production with backup"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"backup-and-recovery",children:"Backup and Recovery"}),"\n",(0,s.jsx)(n.h3,{id:"backup-strategy",children:"Backup Strategy"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Full Backups"}),": Daily at 2:00 AM UTC"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Incremental Backups"}),": Every 6 hours"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Transaction Logs"}),": Continuous archiving"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Retention"}),": 30 days for daily, 7 days for incremental"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"recovery-procedures",children:"Recovery Procedures"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Point-in-time recovery capability"}),"\n",(0,s.jsx)(n.li,{children:"Automated backup verification"}),"\n",(0,s.jsx)(n.li,{children:"Documented restore procedures"}),"\n",(0,s.jsx)(n.li,{children:"Regular disaster recovery drills"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,s.jsx)(n.h3,{id:"indexing-strategy",children:"Indexing Strategy"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Primary keys on all tables (UUID)"}),"\n",(0,s.jsx)(n.li,{children:"Unique indexes on email, employee_id, code_data"}),"\n",(0,s.jsx)(n.li,{children:"Composite indexes for common query patterns"}),"\n",(0,s.jsx)(n.li,{children:"Partial indexes for filtered queries"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"query-optimization",children:"Query Optimization"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Connection pooling (min: 5, max: 20)"}),"\n",(0,s.jsx)(n.li,{children:"Prepared statements for frequent queries"}),"\n",(0,s.jsx)(n.li,{children:"Query result caching (Redis future consideration)"}),"\n",(0,s.jsx)(n.li,{children:"EXPLAIN ANALYZE for slow queries"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"future-enhancements",children:"Future Enhancements"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Table partitioning for attendance_records by date"}),"\n",(0,s.jsx)(n.li,{children:"Read replicas for reporting queries"}),"\n",(0,s.jsx)(n.li,{children:"Materialized views for complex reports"}),"\n",(0,s.jsx)(n.li,{children:"Archived data strategy for old records"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.admonition,{title:"Database Management",type:"tip",children:(0,s.jsx)(n.p,{children:"Regular database maintenance includes VACUUM, ANALYZE, and index rebuilding to maintain optimal performance. Monitoring tools track query performance, connection pool usage, and slow query logs."})})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>t});var r=i(6540);const s={},d=r.createContext(s);function l(e){const n=r.useContext(d);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);